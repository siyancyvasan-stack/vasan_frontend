<div class="space-y-8">
  <!-- KPI Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Next Payroll Date -->
    <div class="bg-white p-6 rounded-lg shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1 relative overflow-hidden">
      <div class="absolute top-0 left-0 h-1.5 w-full bg-gradient-to-r from-purple-500 to-pink-500"></div>
      <div class="flex items-center justify-between">
        <p class="text-sm font-medium text-gray-500">Next Payroll Date</p>
        <div class="w-10 h-10 flex items-center justify-center bg-purple-100 rounded-lg">
          <i class="fa-solid fa-calendar-check text-purple-500 text-xl"></i>
        </div>
      </div>
      <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats().nextPayrollDate | date:'MMM d, yyyy' }}</p>
      <p class="text-xs text-gray-400 mt-1">in {{ daysUntilNextPayroll() | number:'1.0-0' }} days</p>
    </div>

    <!-- Total Payroll Cost -->
    <div class="bg-white p-6 rounded-lg shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1 relative overflow-hidden">
      <div class="absolute top-0 left-0 h-1.5 w-full bg-gradient-to-r from-cyan-500 to-sky-500"></div>
      <div class="flex items-center justify-between">
        <p class="text-sm font-medium text-gray-500">Total Payroll Cost</p>
        <div class="w-10 h-10 flex items-center justify-center bg-cyan-100 rounded-lg">
          <i class="fa-solid fa-dollar-sign text-cyan-500 text-xl"></i>
        </div>
      </div>
      <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats().totalPayrollCost | currency:'USD' }}</p>
      <div class="flex items-center text-xs mt-1" [class.text-green-600]="stats().costChangePercent >= 0" [class.text-red-600]="stats().costChangePercent < 0">
        <i class="fa-solid mr-1" [class.fa-arrow-up]="stats().costChangePercent >= 0" [class.fa-arrow-down]="stats().costChangePercent < 0"></i>
        <span>{{ stats().costChangePercent | number:'1.1-1' }}% vs last month</span>
      </div>
    </div>

    <!-- Active Employees -->
    <div class="bg-white p-6 rounded-lg shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1 relative overflow-hidden">
      <div class="absolute top-0 left-0 h-1.5 w-full bg-gradient-to-r from-sky-500 to-indigo-500"></div>
      <div class="flex items-center justify-between">
        <p class="text-sm font-medium text-gray-500">Active Employees</p>
        <div class="w-10 h-10 flex items-center justify-center bg-sky-100 rounded-lg">
          <i class="fa-solid fa-users text-sky-500 text-xl"></i>
        </div>
      </div>
      <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats().activeEmployees }}</p>
      <p class="text-xs text-green-600 font-medium mt-1">+ {{ stats().newEmployeesThisMonth }} new this payroll run</p>
    </div>

    <!-- Pending Approvals -->
    <div class="bg-white p-6 rounded-lg shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1 relative overflow-hidden">
      <div class="absolute top-0 left-0 h-1.5 w-full bg-gradient-to-r from-pink-500 to-red-500"></div>
      <div class="flex items-center justify-between">
        <p class="text-sm font-medium text-gray-500">Pending Approvals</p>
        <div class="w-10 h-10 flex items-center justify-center bg-pink-100 rounded-lg">
          <i class="fa-solid fa-clock text-pink-500 text-xl"></i>
        </div>
      </div>
      <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats().pendingApprovals }}</p>
      <p class="text-xs text-gray-400 mt-1">Awaiting review</p>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Recent Payroll Runs -->
    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
        <div>
          <h2 class="text-lg font-semibold text-gray-700">Recent Payroll Runs</h2>
          <p class="text-sm text-gray-500">History of completed and processing runs</p>
        </div>
        <div class="flex items-center gap-2 w-full sm:w-auto">
          <div class="relative flex-grow">
            <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            <input 
              type="text" 
              placeholder="Search by Run ID..." 
              class="w-full pl-9 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-shadow text-sm"
              [ngModel]="searchQuery()"
              (ngModelChange)="searchQuery.set($event); currentPage.set(1)">
          </div>
          <button (click)="viewAll()" class="text-sm font-medium text-cyan-600 hover:text-cyan-800 whitespace-nowrap px-3 py-2 rounded-md hover:bg-gray-100 transition-colors">View All</button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Run ID</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Date</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Employees</th>
              <th scope="col" class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">Total Cost</th>
              <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            @for(run of paginatedRuns(); track run.id) {
              <tr class="hover:bg-cyan-50/30 transition-colors duration-200">
                <td class="px-4 py-4 whitespace-nowrap text-sm font-mono text-gray-500">{{ run.id }}</td>
                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">{{ run.date | date:'MMM dd, yyyy' }}</td>
                <td class="px-4 py-4 whitespace-nowrap text-sm">
                  <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full" [class]="getStatusClass(run.status)">
                    {{ run.status }}
                  </span>
                </td>
                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">{{ run.employeeCount }}</td>
                <td class="px-4 py-4 whitespace-nowrap text-sm text-right text-gray-800 font-mono">{{ run.totalCost | currency:'USD' }}</td>
                <td class="px-4 py-4 whitespace-nowrap text-center text-sm font-medium">
                  <button (click)="viewReport(run)" class="px-3 py-1 text-xs font-medium text-cyan-700 bg-cyan-100 rounded-md hover:bg-cyan-200 transition-colors">View Report</button>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="6" class="text-center py-10 text-gray-500">
                  No payroll runs found for your search.
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
      <!-- Pagination -->
      @if (totalPages() > 1) {
        <div class="flex justify-end items-center mt-4 text-sm">
          <span class="text-gray-600 mr-4">Page {{ currentPage() }} of {{ totalPages() }}</span>
          <div class="flex gap-1">
            <button (click)="changePage(currentPage() - 1)" [disabled]="currentPage() === 1" 
                    class="px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 transition-colors">
              Previous
            </button>
            <button (click)="changePage(currentPage() + 1)" [disabled]="currentPage() === totalPages()"
                    class="px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 transition-colors">
              Next
            </button>
          </div>
        </div>
      }
    </div>

    <!-- Payroll Cost Trend -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-lg font-semibold text-gray-700 mb-4">Payroll Cost Trend</h2>
      <p class="text-sm text-gray-500 mb-4">Last 6 months</p>
      <app-cost-trend-chart [data]="payrollCostHistory"></app-cost-trend-chart>
    </div>
  </div>
</div>

@if(showDetailsModal() && selectedRun()) {
  <app-payroll-run-details-modal 
    [run]="selectedRun()!" 
    (close)="handleCloseModal()">
  </app-payroll-run-details-modal>
}

@if(notification()) {
  <app-notification 
    [message]="notification()!.message" 
    [type]="notification()!.type"
    (close)="notification.set(null)">
  </app-notification>
}
